<!doctype html>
<html>

<head>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>魚菜共生教材包</title>
  <script src="https://blocklypro.webduino.io/node_modules/jquery/dist/jquery.min.js?rev=2f6b11a7e914718e0290410e85366fe9"></script>
  <script src="https://blocklypro.webduino.io/dist/lib/webduino-all-0.4.20.min.js?rev=4426739c00d85325cb2d3d701fa50666"></script>
  <script src="https://blocklypro.webduino.io/dist/webduino-blockly.min.js?rev=736fa9a2fba9fa461db7c329f6651493"></script>
  <script src="https://blocklypro.webduino.io/dist/lib/firebase.min.js?rev=c0bfd493efd477d098a4ae9e92b13880"></script>
  <script src="https://blocklypro.webduino.io/dist/lib/runtime.min.js?rev=683a69503433786202911b4d9f766100"></script>
  <script src="https://blocklypro.webduino.io/node_modules/webduino-module-dht/Dht.js"></script>
  <script src="https://blocklypro.webduino.io/node_modules/webduino-module-dht/Dht-blockly.js"></script>  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
	#demo-area-01-show { font-size: 60px; pointer-events: auto!important; }  
  </style>
  <script>
    $(document).ready(function () {

var dht1;
var ph;
var power;
var dht2;
var dht;
var matrix;
var photocell;
var photocell_value;
var _E7_B9_BC_E9_9B_BB_E5_99_A8;
var _E9_9B_BB_E6_BA_90_E9_96_8B_E9_97_9C;
var temp;
var myData;

function get_date(t) {
  var varDay = new Date(),
    varYear = varDay.getFullYear(),
    varMonth = varDay.getMonth() + 1,
    varDate = varDay.getDate();
  var varNow;
  if (t == "ymd") {
    varNow = varYear + "/" + varMonth + "/" + varDate;
  } else if (t == "mdy") {
    varNow = varMonth + "/" + varDate + "/" + varYear;
  } else if (t == "dmy") {
    varNow = varDate + "/" + varMonth + "/" + varYear;
  } else if (t == "y") {
    varNow = varYear;
  } else if (t == "m") {
    varNow = varMonth;
  } else if (t == "d") {
    varNow = varDate;
  }
  return varNow;
}

function get_time(t) {
  var varTime = new Date(),
    varHours = varTime.getHours(),
    varMinutes = varTime.getMinutes(),
    varSeconds = varTime.getSeconds();
  var varNow;
  if (t == "hms") {
    varNow = varHours + ":" + varMinutes + ":" + varSeconds;
  } else if (t == "h") {
    varNow = varHours;
  } else if (t == "m") {
    varNow = varMinutes;
  } else if (t == "s") {
    varNow = varSeconds;
  }
  return varNow;
}


boardReady({device: 'o857'}, function (board) {
  board.samplingInterval = 1000;
  dht1 = 0;
  ph = 0;
  power = 0;
  dht2 = 0;
  dht = getDht(board, 11);
  matrix = getMax7219(board, 3, 5, 6);
  photocell = getPhotocell(board, 5);
  photocell_value = 0;
  _E7_B9_BC_E9_9B_BB_E5_99_A8 = getLed(board, 10);
  _E9_9B_BB_E6_BA_90_E9_96_8B_E9_97_9C = 0;
  temp = new Firebase('https://youoktemp.firebaseio.com/');
  dht.read(function(evt){
    dht1 = dht.temperature;
    dht2 = dht.humidity;
    photocell.measure(function (val) {
      photocell.detectedVal = val;
      photocell_value = Math.round(((photocell.detectedVal - (0)) * (1/((1)-(0)))) * ((100)-(0)) + (0));
    });
    var varData = [max7219_number(dht1), max7219_number(dht2), max7219_number(photocell_value)];
    matrix.animateStop();
    matrix.on('0000000000000000');
    matrix.animate(varData, 1000);
    myData= {};
    myData.sheetUrl = 'https://docs.google.com/spreadsheets/d/1U6Pl3GaoN_kDqvHnIYgg7A_dkbG1NqSh2GVwwzmeVFU/edit?usp=sharing';
    myData.sheetName = '工作表1';
    myData.column0 = get_date("ymd");
    myData.column1 = get_time("hms");
    myData.column2 = dht1;
    myData.column3 = dht2;
    myData.column4 = photocell_value;
    myData.column5 = ph;
    myData.column6 = power;
    writeSheetData(myData);
    document.getElementById('demo-area-01-show').innerHTML = (['現在時間<BR>',get_date("ymd"),'-',get_time("hms"),'<BR>溫度(C)/濕度(%)<BR>',dht1,'/',dht2,'<BR>光感度:',photocell_value,'<BR>PH 值:',ph,'<BR>啟動抽水馬達:',power].join(''));
	document.getElementById('demo-area-02-show').innerHTML = ([dht1,'/',dht2].join(''));
	document.getElementById('demo-area-03-show').innerHTML = ([photocell_value].join(''));
	document.getElementById('demo-area-04-show').innerHTML = ([ph].join(''));
	document.getElementById('demo-area-05-show').innerHTML = ([power].join(''));
	
    temp.set({});
    temp.push({
      temp: dht1,
      hum: dht2,
      photocell: photocell_value,
      power: ph,
      ph: power
    });
  }, 1000);
});

    });
	
	
	
  </script>
</head>

<body>


  <h1 >現在溫度(度C):<div><span id="demo-area-01-show"></span></div></h1>
  <h1>現在濕度(%):<div><span id="demo-area-02-show"></span></div></h1>
  <h1>現在光感度:<div><span id="demo-area-03-show"></span></div></h1>
  <h1>現在PH值:<div><span id="demo-area-04-show"></span></div></h1>
  <h1>泵浦是否啟動:<div><span id="demo-area-05-show"></span></div></h1>
  <hr>
  <button type="button" style="width:120px;height:40px;font-size:20px;">開啟泵浦</button>
  <button type="button" style="width:120px;height:40px;font-size:20px;">關閉泵浦</button>
</body>

</html>